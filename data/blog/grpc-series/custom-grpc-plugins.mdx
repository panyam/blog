---
title: 'Building custom plugins gRPC'
date: 2023-03-01T15:32:14Z
lastmod: '2022-05-05'
tags: ['grpc', 'protogen', 'buf', 'guide']
draft: false
summary: 'A guide to create custom grpc plugins in Go with protogen and buf'
layout: PostSimple
bibliography: references-data.bib
---

As developers, few things are more comforting than the mighty command-line.   For generated APIs (whether rpc or http) while generic CLIs can provide access (eg curl for a generated HTTP gateway) these still need a user to know (or atleast remember) the http semantics etc.   A CLI exec/binary with simpler structure, some predefined conventions and more targeted documentation etc can significantly ease accessing the APIs from the command line.  These can even be useful tools/artifacts to offer the consumers of your services.

Without further Ado let us dive into building a grpc plugin that generates one or more CLIs from custom annotations (defined in this tutorial) added to your protobuf definitions for your grpc services.

Note - this tutorial is **NOT** an in-depth tutorial for creating a grpc based service or creating http gateways for the grpc service.   A simple enough service example will be provided that can highlight the various of nuances of building a plugin instead.  Look at Part 1 for this.

### Getting Started

This tutorial assumes you have the following tooling already installed:

* golang (v1.18+)
* [buf](https://buf.build/docs/installation)  - We will get to this shortly!

Note - this tutorial is **NOT** a generic tutorial for creating a grpc based service or creating http gateways for the grpc service.   Though the demo/example service ([grpcdemo](github.com/panyam/grpcdemo)) contains a full-fledge grpc service and its associated REST based http gateway, this tutorial will focus on


1. Creating a plugin using buf and protogen that will generate a python application that can be used as a CLI interface to our service.
2. Highlight some options to configure the fields, method and services in our demo.

If you are in a rush, check out the [plugin's source code](github.com/panyam/proto2cli).

A quick primer on generating services, clients etc with grpc specs:

1. The protoc utility provided by the grpc/protobuf team takes as input protobuf files (.proto) that contain service descriptions (services, methods, models etc).  The command looks a bit like:

```
protoc --go_out="./gen" --go-grpc_out="./gen" --go_opt=paths=source_relative \
       --go-grpc_opt=paths=surce_relative
```

2. The magic of the protoc utility is that it does not do any generation on its 
